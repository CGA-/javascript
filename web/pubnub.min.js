// 3.4.2
(function(){
var m=null;function p(){return function(){}}
window.JSON&&window.JSON.stringify||function(){function a(){try{return this.valueOf()}catch(a){return m}}function c(a){d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var b=y[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(d,x){var l,g,h,q,k,i=e,f=x[d];f&&"object"===typeof f&&(f=a.call(f));"function"===typeof n&&(f=n.call(x,d,f));switch(typeof f){case "string":return c(f);case "number":return isFinite(f)?String(f):"null";case "boolean":case "null":return String(f);
case "object":if(!f)return"null";e+=j;k=[];if("[object Array]"===Object.prototype.toString.apply(f)){q=f.length;for(l=0;l<q;l+=1)k[l]=b(l,f)||"null";h=0===k.length?"[]":e?"[\n"+e+k.join(",\n"+e)+"\n"+i+"]":"["+k.join(",")+"]";e=i;return h}if(n&&"object"===typeof n){q=n.length;for(l=0;l<q;l+=1)g=n[l],"string"===typeof g&&(h=b(g,f))&&k.push(c(g)+(e?": ":":")+h)}else for(g in f)Object.hasOwnProperty.call(f,g)&&(h=b(g,f))&&k.push(c(g)+(e?": ":":")+h);h=0===k.length?"{}":e?"{\n"+e+k.join(",\n"+e)+"\n"+
i+"}":"{"+k.join(",")+"}";e=i;return h}}window.JSON||(window.JSON={});var d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,j,y={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},n;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,c,d){var g;j=e="";if("number"===typeof d)for(g=0;g<d;g+=1)j+=" ";else"string"===typeof d&&(j=d);if((n=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==
typeof c.length))throw Error("JSON.stringify");return b("",{"":a})});"function"!==typeof JSON.parse&&(JSON.parse=function(a){return eval("("+a+")")})}();function r(){var a=1;return"x"+ ++a+""+ +new Date}function t(){return+new Date}var v,C=Math.floor(20*Math.random());v=function(a){return 0<a.indexOf("pubsub")&&a.replace("pubsub","ps"+(20>++C?C:C=1))||a};function aa(a,c){function b(){e+c>t()?(clearTimeout(d),d=setTimeout(b,c)):(e=t(),a())}var d,e=0;return b}
function D(a,c){if(a&&c)if("undefined"!=typeof a[0])for(var b=0,d=a.length;b<d;)c.call(a[b],a[b],b++);else for(b in a)a.hasOwnProperty&&a.hasOwnProperty(b)&&c.call(a[b],b,a[b])}function G(a,c){var b=[];D(a||[],function(a,e){b.push(c(a,e))});return b}function ba(a,c){var b=[];D(a||[],function(a){c(a)&&b.push(a)});return b}var H={list:{},unbind:function(a){H.list[a]=[]},bind:function(a,c){(H.list[a]=H.list[a]||[]).push(c)},fire:function(a,c){D(H.list[a]||[],function(a){a(c)})}};
function ca(a,c){return a.replace(/{([\w\-]+)}/g,function(a,d){return c[d]||a})}var I=Math.floor(20*Math.random());v=function(a){return 0<a.indexOf("pubsub")&&a.replace("pubsub","ps"+(20>++I?I:I=1))||a};function K(a){return G(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function L(a){var c=[];D(a,function(a,d){d.g&&c.push(a)});return c.sort()}SECOND=1E3;
if(!window.PUBNUB){var M=function(a){return document.getElementById(a)},N=function(a,c){var b=[];D(a.split(/\s+/),function(a){D((c||document).getElementsByTagName(a),function(a){b.push(a)})});return b},O=function(a,c,b){D(a.split(","),function(a){function e(a){a||(a=window.event);b(a)||(a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}c.addEventListener?c.addEventListener(a,e,!1):c.attachEvent?c.attachEvent("on"+a,e):c["on"+a]=e})},P=
function(){return N("head")[0]},Q=function(a,c,b){if(b)a.setAttribute(c,b);else return a&&a.getAttribute&&a.getAttribute(c)},R=function(a,c){for(var b in c)if(c.hasOwnProperty(b))try{a.style[b]=c[b]+(0<"|width|height|top|left|".indexOf(b)&&"number"==typeof c[b]?"px":"")}catch(d){}},S=function(a){return document.createElement(a)},da=function(){return T||V()?0:r()},W=function(a){function c(a,b){A||(A=1,a||J(b),i.onerror=m,clearTimeout(F),setTimeout(function(){a&&s();var b=M(f),c=b&&b.parentNode;c&&
c.removeChild(b)},SECOND))}if(T||V()){a:{var b,d,e=function(){if(!y){y=1;clearTimeout(w);try{d=JSON.parse(b.responseText)}catch(a){return g(1)}l(d)}},j=0,y=0,n=a.timeout||ea,w=setTimeout(function(){g(1)},n),x=a.b||p(),l=a.c||p(),g=function(a){j||(j=1,clearTimeout(w),b&&(b.onerror=b.onload=m,b.abort&&b.abort(),b=m),a&&x())};try{b=V()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest;b.onerror=b.onabort=function(){g(1)};b.onload=b.onloadend=e;b.timeout=n;var h=a.url.join(fa);if(a.data){var e=
[],q,h=h+"?";for(q in a.data)e.push(q+"="+a.data[q]);h+=e.join(ia)}b.open("GET",h,typeof("undefined"===a.h));b.send()}catch(k){g(0);T=0;a=W(a);break a}a=g}return a}var i=S("script"),h=a.a,f=r(),A=0,F=setTimeout(function(){c(1)},a.timeout||ea),s=a.b||p(),J=a.c||p();window[h]=function(a){c(0,a)};a.h||(i[ja]=ja);i.onerror=function(){c(1)};i.src=a.url.join(fa);if(a.data){h=[];i.src+="?";for(key in a.data)h.push(key+"="+a.data[key]);i.src+=h.join(ia)}Q(i,"id",f);P().appendChild(i);return c},V=function(){if(!ka.get)return 0;
var a={id:V.id++,send:p(),abort:function(){a.id={}},open:function(c,b){V[a.id]=a;ka.get(a.id,b)}};return a},ja="async",fa="/",ia="&",ea=1E4,T=-1==navigator.userAgent.indexOf("MSIE 6");window.console||(window.console=window.console||{});console.log||(console.log=console.error=(window.opera||{}).postError||p());var X,Y=window.localStorage;X={get:function(a){try{return Y?Y.getItem(a):-1==document.cookie.indexOf(a)?m:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||m}catch(c){}},set:function(a,
c){try{if(Y)return Y.setItem(a,c)&&0;document.cookie=a+"="+c+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(b){}}};var Z=M("pubnub")||{},la=function(a){function c(){}function b(){}function d(a){D(L(j),function(b){(b=j[b])&&a(b)})}var e=a.subscribe_key||"";a.uuid||X.get(e+"uuid");e={xdr:W,db:X,each:D,map:G,grep:ba,css:R,$:M,create:S,bind:O,supplant:ca,head:P,search:N,attr:Q,now:t,unique:r,events:H,updater:aa,init:la};a.xdr=W;a.db=X;a.jsonp_cb=da;a.bind_leave=function(){O("beforeunload",window,
function(){each_channel(p());return!0})};var j={},y=[],n=0,w="-pnpres",x=0,l=0,g=0,h=0,q=0,k=0,i=a.publish_key||"",f=a.subscribe_key||"",A=a.ssl?"s":"",F=a.db||{set:p(),get:p()},s=a.jsonp_cb||function(){return 0},J=a.bind_leave||p(),z=a.xdr,E=a.uuid||F.get(f+"uuid")||"",u="http"+A+"://"+(a.origin||"pubsub.pubnub.com"),B={history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||p(),g=a.channel,h=a.start,i=a.end,j={},l=s();if(!g)return error("Missing Channel");
if(!b)return error("Missing Callback");if(!f)return error("Missing Subscribe Key");j.stringtoken="true";j.count=c;j.reverse=d;h&&(j.start=h);i&&(j.end=i);z({a:l,data:j,c:function(a){b(a)},b:e,url:[u,"v2","history","sub-key",f,"channel",K(g)]})},replay:function(a){var b=b||a.callback||p(),c=a.source,d=a.destination,e=a.stop,g=a.start,h=a.end,j=a.reverse,a=a.limit,l=s(),k={};if(!c)return error("Missing Source Channel");if(!d)return error("Missing Destination Channel");if(!i)return error("Missing Publish Key");
if(!f)return error("Missing Subscribe Key");"0"!=l&&(k.callback=l);e&&(k.stop="all");j&&(k.reverse="true");g&&(k.start=g);h&&(k.end=h);a&&(k.count=a);z({a:l,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[u,"v1","replay",i,f,c,d],data:k})},time:function(a){var b=s();z({a:b,url:[u,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},uuid:function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});
a&&a(b);return b},publish:function(a,b){var b=b||a.callback||p(),c=a.message,d=a.channel,e=s();if(!c)return error("Missing Message");if(!d)return error("Missing Channel");if(!i)return error("Missing Publish Key");if(!f)return error("Missing Subscribe Key");c=JSON.stringify(c);c=[u,"publish",i,f,0,K(d),e,K(c)];z({a:e,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:c,data:{uuid:E}})},unsubscribe:function(a){a=a.channel;k=0;h=1;a=G((a.join?a.join(","):""+a).split(","),function(a){return a+
","+a+w}).join(",");D(a.split(","),function(a){n&&b(a,0);j[a]=0});n&&c()},subscribe:function(a,b){function e(){var a=s(),b=L(j).join(",");b&&(g=z({timeout:pa,a:a,data:{uuid:E},url:[ga,"subscribe",f,K(b),a,k],b:function(){d(function(a){a.d||(a.d=1,a.k(a.name))});ga=v(u);setTimeout(e,SECOND);B.time(function(a){d(function(b){a&&b.d&&(b.d=0,b.l(b.name))})})},c:function(a){if(!a)return setTimeout(e,ha);d(function(a){a.f||(a.f=1,a.j(a.name))});k=!k&&h&&F.get(f)||a[1];F.set(f,a[1]);var b,c=(2<a.length?a[2]:
"").split(",");b=function(){var a=c.shift()||"";return[(j[a]||{}).a||x,(a||l).split(w)[0]]};D(a[0],function(c){var d=b();if(j[d[1]].g)d[0](c,a,d[1])});setTimeout(e,ha)}}))}var i=a.channel,b=(b=b||a.callback)||a.message,ma=a.error||p(),A=a.connect||p(),J=a.reconnect||p(),na=a.disconnect||p(),U=a.presence||0,oa=a.noheresync||0,pa=a.timeout||31E4,ha=a.windowing||10,qa=a.restore,ga=v(u);qa&&(h=1);if(!i)return error("Missing Channel");if(!b)return error("Missing Callback");if(!f)return error("Missing Subscribe Key");
D((i.join?i.join(","):""+i).split(","),function(a){var c=j[a]||{};j[l=a]={name:a,f:c.f,d:c.d,g:1,a:x=b,j:A,error:ma,k:na,l:J};U&&(B.subscribe({channel:a+w,callback:U}),!c.g&&!oa&&B.here_now({channel:a,callback:function(b){D("uuids"in b?b.uuids:[],function(c){U({action:"join",uuid:c,timestamp:t(),occupancy:b.occupancy||1},b,a)})}}))});c=function(){g&&g();clearTimeout(q);q=setTimeout(e,100)};if(!n)return y.push(c);c()},here_now:function(a,b){var b=a.callback||b,c=a.error||p(),d=a.channel,e=s(),g={};
if(!d)return error("Missing Channel");if(!b)return error("Missing Callback");if(!f)return error("Missing Subscribe Key");"0"!=e&&(g.callback=e);z({a:e,data:g,c:function(a){b(a)},b:c,url:[u,"v2","presence","sub_key",f,"channel",K(d)]})},ready:function(){B.time(t);B.time(function(){setTimeout(function(){n||(n=1,D(y,function(a){a()}))},SECOND)})}},b=function(a,b){var c={uuid:E},d=v(u),e=s();0<a.indexOf(w)||("0"!=e&&(c.callback=e),z({h:b||A,timeout:2E3,a:e,data:c,url:[d,"v2","presence","sub_key",f,"channel",
K(a),"leave"]}))};E||(E=B.uuid());F.set(f+"uuid",E);J();e.__proto__=B;return e};PUBNUB=la({publish_key:Q(Z,"pub-key"),subscribe_key:Q(Z,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==Q(Z,"ssl"),origin:Q(Z,"origin"),uuid:Q(Z,"uuid")});R(Z,{position:"absolute",top:-SECOND});if("opera"in window||Q(Z,"flash"))Z.innerHTML="<object id=pubnubs data=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=movie value=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=allowscriptaccess value=always></object>";
var ka=M("pubnubs")||{};O("load",window,function(){var a=PUBNUB.ready();setTimeout(a,0)});PUBNUB.rdx=function(a,c){if(!c)return V[a].onerror();V[a].responseText=unescape(c);V[a].onload()};V.id=SECOND;window.jQuery&&(window.jQuery.PUBNUB=PUBNUB);"undefined"!==typeof module&&(module.exports=PUBNUB)&&ready()}
var $=PUBNUB.ws=function(a,c){if(!(this instanceof $))return new $(a,c);var b=this,a=b.url=a||"";b.protocol=c||"Sec-WebSocket-Protocol";var d=a.split("/"),d={ssl:"wss:"===d[0],origin:d[2],publish_key:d[3],subscribe_key:d[4],channel:d[5]};b.CONNECTING=0;b.OPEN=1;b.CLOSING=2;b.CLOSED=3;b.CLOSE_NORMAL=1E3;b.CLOSE_GOING_AWAY=1001;b.CLOSE_PROTOCOL_ERROR=1002;b.CLOSE_UNSUPPORTED=1003;b.CLOSE_TOO_LARGE=1004;b.CLOSE_NO_STATUS=1005;b.CLOSE_ABNORMAL=1006;b.onclose=b.onerror=b.onmessage=b.onopen=b.onsend=p();
b.binaryType="";b.extensions="";b.bufferedAmount=0;b.trasnmitting=!1;b.buffer=[];b.readyState=b.CONNECTING;if(!a)return b.readyState=b.CLOSED,b.onclose({code:b.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!0}),b;b.e=PUBNUB.init(d);b.e.i=d;b.i=d;b.e.subscribe({restore:!1,channel:d.channel,disconnect:b.onerror,reconnect:b.onopen,error:function(){b.onclose({code:b.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!1})},callback:function(a){b.onmessage({data:a})},connect:function(){b.readyState=b.OPEN;b.onopen()}})};
$.prototype.send=function(a){var c=this;c.e.publish({channel:c.e.i.channel,message:a,callback:function(a){c.onsend({data:a})}})};
})();
