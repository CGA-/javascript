// 3.4.3
(function(){
var k=!0,l=null,m=!1;function q(){return function(){}}function x(a){return function(){return a}}var C=1,D=m,F=[],G="-pnpres",H=10,J=310,M=60,N=1E3,aa=/{([\w\-]+)}/g;function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var Q,ca=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++ca?ca:ca=1))||a};function da(a,b){function c(){f+b>P()?(clearTimeout(d),d=setTimeout(c,b)):(f=P(),a())}var d,f=0;return c}
function ea(a,b){var c=[];W(a||[],function(a){b(a)&&c.push(a)});return c}function fa(a,b){return a.replace(aa,function(a,d){return b[d]||a})}function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}
function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];W(a||[],function(a,f){c.push(b(a,f))});return c}function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,d){d.f&&b.push(a)});return b.sort()}
function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},N)}
function la(a){function b(){}function c(a){a&&(s.g=0);!s.g&&s.length&&(s.g=1,t(s.shift()))}function d(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,n=(+a.timeout||J)*N,u=(+a.keepalive||M)*N,r=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),s=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,O=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var d={uuid:B},c=Q(y),p=v();0<a.indexOf(G)||("0"!=p&&(d.callback=p),t({l:b||w,timeout:2E3,a:p,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",p=a.error||q(),e=a.channel,n=a.start,f=a.end,h={},i=v();if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=d;h.reverse=c;i&&(h.callback=
i);n&&(h.start=n);f&&(h.end=f);t({a:i,data:h,c:function(a){b(a)},b:p,url:[z,"v2","history","sub-key",g,"channel",Z(e)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,p=a.stop,e=a.start,n=a.end,f=a.reverse,a=a.limit,h=v(),i={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);p&&(i.stop="all");f&&(i.reverse="true");e&&(i.start=
e);n&&(i.end=n);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",r,g,d,c],data:i})},time:function(a){var b=v();t({a:b,timeout:5*N,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,I=a.channel,p=v();if(!d)return error("Missing Message");if(!I)return error("Missing Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
I=[z,"publish",r,g,0,Z(I),p,Z(d)];s.push({a:p,timeout:5*N,url:I,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,c){function ia(a){a?X(I,N):(z=Q(y,1),S=Q(y,1),X(function(){e.time(ia)},N));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function I(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:r,a:a,b:function(){e.time(ia)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(I,u);d(function(a){a.e||(a.e=1,a.h(a.name))});(E=!E&&L&&A.get(g)||a[1])&&A.set(g,a[1]);var b,ha=(2<a.length?a[2]:"").split(",");b=function(){var a=ha.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(ha){var d=b();if(j[d[1]].f)d[0](ha,a,d[1])});X(I,u)}}))}var p=a.channel,c=(c=c||a.callback)||a.message,ja=a.connect||
q(),ya=a.reconnect||q(),s=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,r=a.timeout||n,u=a.windowing||f;a.restore&&(L=1);E=0;if(!p)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((p.join?p.join(","):""+p).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=c,h:ja,i:s,j:ya};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in b?b.uuids:[],function(ha){h({action:"join",
uuid:ha,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(I,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,p=v(),e=l;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=p&&(e={},e.callback=p);t({a:p,data:e,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",Z(c)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,
map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){O()||e._reset_offline();X(e.poll_online,N)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,N);X(e.poll_online2,u);return e}
function ma(a){function b(a){f||(f=1,clearTimeout(u),d&&(d.onerror=d.onload=l,d.abort&&d.abort(),d=l),a&&r())}function c(){if(!n){n=1;clearTimeout(u);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,n=0,u=X(function(){b(1)},na),r=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=na;url=a.url.join(oa);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(pa)}d.open("GET",url,k);d.send()}catch(y){return b(0),ma(a)}return b}function qa(a,b,c){W(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=k,a.returnValue=m,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,m):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function ra(a){a.db=sa;a.xdr=ma;var b=la(a);b.init=ra;if(a.notest)return b;qa("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});qa("offline",window,b._reset_offline);qa("offline",document,b._reset_offline);b.ready();return b}var oa="/",pa="&",na=31E4,sa,ta="undefined"!=typeof localStorage&&localStorage;
sa={get:function(a){try{return ta?ta.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(ta)return ta.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=ra)||"undefined"!==typeof exports&&(exports.k=ra)||(PUBNUB=ra);C=1;D=m;F=[];G="-pnpres";H=10;J=310;M=60;N=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var ua=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++ua?ua:ua=1))||a};function da(a,b){function c(){f+b>P()?(clearTimeout(d),d=setTimeout(c,b)):(f=P(),a())}var d,f=0;return c}function ea(a,b){var c=[];W(a||[],function(a){b(a)&&c.push(a)});return c}function fa(a,b){return a.replace(aa,function(a,d){return b[d]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];W(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},N)}
function la(a){function b(){}function c(a){a&&(s.g=0);!s.g&&s.length&&(s.g=1,t(s.shift()))}function d(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,n=(+a.timeout||J)*N,u=(+a.keepalive||M)*N,r=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),s=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,O=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var d={uuid:B},c=Q(y),p=v();0<a.indexOf(G)||("0"!=p&&(d.callback=p),t({l:b||w,timeout:2E3,a:p,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",p=a.error||q(),e=a.channel,f=a.start,n=a.end,h={},i=v();if(!e)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=d;h.reverse=c;i&&(h.callback=
i);f&&(h.start=f);n&&(h.end=n);t({a:i,data:h,c:function(a){b(a)},b:p,url:[z,"v2","history","sub-key",g,"channel",Z(e)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,p=a.stop,e=a.start,f=a.end,n=a.reverse,a=a.limit,h=v(),i={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);p&&(i.stop="all");n&&(i.reverse="true");e&&(i.start=
e);f&&(i.end=f);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",r,g,d,c],data:i})},time:function(a){var b=v();t({a:b,timeout:5*N,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,e=a.channel,p=v();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[z,"publish",r,g,0,Z(e),p,Z(d)];s.push({a:p,timeout:5*N,url:e,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,c){function ia(a){a?X(I,N):(z=Q(y,1),S=Q(y,1),X(function(){e.time(ia)},N));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function I(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:r,a:a,b:function(){e.time(ia)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(I,u);d(function(a){a.e||(a.e=1,a.h(a.name))});(E=!E&&L&&A.get(g)||a[1])&&A.set(g,a[1]);var b,ha=(2<a.length?a[2]:"").split(",");b=function(){var a=ha.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(ha){var d=b();if(j[d[1]].f)d[0](ha,a,d[1])});X(I,u)}}))}var p=a.channel,c=(c=c||a.callback)||a.message,ja=a.connect||
q(),ya=a.reconnect||q(),s=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,r=a.timeout||n,u=a.windowing||f;a.restore&&(L=1);E=0;if(!p)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((p.join?p.join(","):""+p).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=c,h:ja,i:s,j:ya};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in b?b.uuids:[],function(ha){h({action:"join",
uuid:ha,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(I,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,p=v(),e=l;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=p&&(e={},e.callback=p);t({a:p,data:e,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",Z(c)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,
map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){O()||e._reset_offline();X(e.poll_online,N)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,N);X(e.poll_online2,u);return e}
function va(a){function b(a){f||(f=1,clearTimeout(u),d&&(d.onerror=d.onload=l,d.abort&&d.abort(),d=l),a&&r())}function c(){if(!n){n=1;clearTimeout(u);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,n=0,u=X(function(){b(1)},wa),r=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=wa;url=a.url.join(xa);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(za)}d.open("GET",url,k);d.send()}catch(y){return b(0),va(a)}return b}function Aa(a,b,c){W(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=k,a.returnValue=m,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,m):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Ba(a){a.db=Ca;a.xdr=va;var b=la(a);b.init=Ba;if(a.notest)return b;Aa("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});Aa("offline",window,b._reset_offline);Aa("offline",document,b._reset_offline);b.ready();return b}var xa="/",za="&",wa=31E4,Ca,Da="undefined"!=typeof localStorage&&localStorage;
Ca={get:function(a){try{return Da?Da.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(Da)return Da.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=Ba)||"undefined"!==typeof exports&&(exports.k=Ba)||(PUBNUB=Ba);C=1;D=m;F=[];G="-pnpres";H=10;J=310;M=60;N=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var Ea=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++Ea?Ea:Ea=1))||a};function da(a,b){function c(){f+b>P()?(clearTimeout(d),d=setTimeout(c,b)):(f=P(),a())}var d,f=0;return c}function ea(a,b){var c=[];W(a||[],function(a){b(a)&&c.push(a)});return c}function fa(a,b){return a.replace(aa,function(a,d){return b[d]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];W(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},N)}
function la(a){function b(){}function c(a){a&&(s.g=0);!s.g&&s.length&&(s.g=1,t(s.shift()))}function d(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,n=(+a.timeout||J)*N,u=(+a.keepalive||M)*N,r=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),s=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,O=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var d={uuid:B},c=Q(y),e=v();0<a.indexOf(G)||("0"!=e&&(d.callback=e),t({l:b||w,timeout:2E3,a:e,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",e=a.error||q(),f=a.channel,n=a.start,j=a.end,h={},i=v();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=d;h.reverse=c;i&&(h.callback=
i);n&&(h.start=n);j&&(h.end=j);t({a:i,data:h,c:function(a){b(a)},b:e,url:[z,"v2","history","sub-key",g,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,e=a.stop,f=a.start,n=a.end,j=a.reverse,a=a.limit,h=v(),i={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);e&&(i.stop="all");j&&(i.reverse="true");f&&(i.start=
f);n&&(i.end=n);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",r,g,d,c],data:i})},time:function(a){var b=v();t({a:b,timeout:5*N,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,e=a.channel,p=v();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[z,"publish",r,g,0,Z(e),p,Z(d)];s.push({a:p,timeout:5*N,url:e,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,c){function ia(a){a?X(I,N):(z=Q(y,1),S=Q(y,1),X(function(){e.time(ia)},N));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function I(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:u,a:a,b:function(){e.time(ia)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(I,w);d(function(a){a.e||(a.e=1,a.h(a.name))});(E=!E&&L&&A.get(g)||a[1])&&A.set(g,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(d){var c=b();if(j[c[1]].f)c[0](d,a,c[1])});X(I,w)}}))}var p=a.channel,c=(c=c||a.callback)||a.message,ja=a.connect||q(),
s=a.reconnect||q(),r=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,u=a.timeout||n,w=a.windowing||f;a.restore&&(L=1);E=0;if(!p)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((p.join?p.join(","):""+p).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=c,h:ja,i:r,j:s};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in b?b.uuids:[],function(d){h({action:"join",
uuid:d,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(I,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,e=v(),f=l;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);t({a:e,data:f,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",Z(c)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,
map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){O()||e._reset_offline();X(e.poll_online,N)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,N);X(e.poll_online2,u);return e}
function Fa(a){function b(a){f||(f=1,clearTimeout(u),d&&(d.onerror=d.onload=l,d.abort&&d.abort(),d=l),a&&r())}function c(){if(!n){n=1;clearTimeout(u);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,n=0,u=X(function(){b(1)},Ga),r=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=Ga;url=a.url.join(Ha);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(Ia)}d.open("GET",url,k);d.send()}catch(y){return b(0),Fa(a)}return b}function Ja(a,b,c){W(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=k,a.returnValue=m,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,m):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Ma(a){a.db=Na;a.xdr=Fa;var b=la(a);b.init=Ma;if(a.notest)return b;Ja("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});Ja("offline",window,b._reset_offline);Ja("offline",document,b._reset_offline);b.ready();return b}var Ha="/",Ia="&",Ga=31E4,Na,Oa="undefined"!=typeof localStorage&&localStorage;
Na={get:function(a){try{return Oa?Oa.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(Oa)return Oa.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=Ma)||"undefined"!==typeof exports&&(exports.k=Ma)||(PUBNUB=Ma);C=1;D=m;F=[];G="-pnpres";H=10;J=310;M=60;N=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var Pa=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++Pa?Pa:Pa=1))||a};function da(a,b){function c(){f+b>P()?(clearTimeout(d),d=setTimeout(c,b)):(f=P(),a())}var d,f=0;return c}function ea(a,b){var c=[];W(a||[],function(a){b(a)&&c.push(a)});return c}function fa(a,b){return a.replace(aa,function(a,d){return b[d]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];W(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},N)}
function la(a){function b(){}function c(a){a&&(s.g=0);!s.g&&s.length&&(s.g=1,t(s.shift()))}function d(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,n=(+a.timeout||J)*N,u=(+a.keepalive||M)*N,r=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),s=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,O=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var d={uuid:B},c=Q(y),e=v();0<a.indexOf(G)||("0"!=e&&(d.callback=e),t({l:b||w,timeout:2E3,a:e,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",e=a.error||q(),f=a.channel,n=a.start,j=a.end,h={},i=v();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=d;h.reverse=c;i&&(h.callback=
i);n&&(h.start=n);j&&(h.end=j);t({a:i,data:h,c:function(a){b(a)},b:e,url:[z,"v2","history","sub-key",g,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,e=a.stop,f=a.start,n=a.end,j=a.reverse,a=a.limit,h=v(),i={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);e&&(i.stop="all");j&&(i.reverse="true");f&&(i.start=
f);n&&(i.end=n);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",r,g,d,c],data:i})},time:function(a){var b=v();t({a:b,timeout:5*N,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,e=a.channel,f=v();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[z,"publish",r,g,0,Z(e),f,Z(d)];s.push({a:f,timeout:5*N,url:e,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,c){function ia(a){a?X(I,N):(z=Q(y,1),S=Q(y,1),X(function(){e.time(ia)},N));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function I(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:w,a:a,b:function(){e.time(ia)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(I,O);d(function(a){a.e||(a.e=1,a.h(a.name))});(E=!E&&L&&A.get(g)||a[1])&&A.set(g,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(d){var c=b();if(j[c[1]].f)c[0](d,a,c[1])});X(I,O)}}))}var p=a.channel,c=(c=c||a.callback)||a.message,s=a.connect||q(),r=
a.reconnect||q(),u=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,w=a.timeout||n,O=a.windowing||f;a.restore&&(L=1);E=0;if(!p)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((p.join?p.join(","):""+p).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=c,h:s,i:u,j:r};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in b?b.uuids:[],function(d){h({action:"join",
uuid:d,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(I,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,e=v(),f=l;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);t({a:e,data:f,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",Z(c)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,
map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){O()||e._reset_offline();X(e.poll_online,N)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,N);X(e.poll_online2,u);return e}
function Qa(a){function b(a){f||(f=1,clearTimeout(u),d&&(d.onerror=d.onload=l,d.abort&&d.abort(),d=l),a&&r())}function c(){if(!n){n=1;clearTimeout(u);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,n=0,u=X(function(){b(1)},Ra),r=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=Ra;url=a.url.join(Sa);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(Ta)}d.open("GET",url,k);d.send()}catch(y){return b(0),Qa(a)}return b}function Ua(a,b,c){W(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=k,a.returnValue=m,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,m):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function Va(a){a.db=Wa;a.xdr=Qa;var b=la(a);b.init=Va;if(a.notest)return b;Ua("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});Ua("offline",window,b._reset_offline);Ua("offline",document,b._reset_offline);b.ready();return b}var Sa="/",Ta="&",Ra=31E4,Wa,Xa="undefined"!=typeof localStorage&&localStorage;
Wa={get:function(a){try{return Xa?Xa.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(Xa)return Xa.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=Va)||"undefined"!==typeof exports&&(exports.k=Va)||(PUBNUB=Va);C=1;D=m;F=[];G="-pnpres";H=10;J=310;M=60;N=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var Ya=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++Ya?Ya:Ya=1))||a};function da(a,b){function c(){f+b>P()?(clearTimeout(d),d=setTimeout(c,b)):(f=P(),a())}var d,f=0;return c}function ea(a,b){var c=[];W(a||[],function(a){b(a)&&c.push(a)});return c}function fa(a,b){return a.replace(aa,function(a,d){return b[d]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];W(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},N)}
function la(a){function b(){}function c(a){a&&(s.g=0);!s.g&&s.length&&(s.g=1,t(s.shift()))}function d(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,n=(+a.timeout||J)*N,u=(+a.keepalive||M)*N,r=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),s=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,O=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var d={uuid:B},c=Q(y),e=v();0<a.indexOf(G)||("0"!=e&&(d.callback=e),t({l:b||w,timeout:2E3,a:e,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",e=a.error||q(),f=a.channel,n=a.start,j=a.end,h={},i=v();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=d;h.reverse=c;i&&(h.callback=
i);n&&(h.start=n);j&&(h.end=j);t({a:i,data:h,c:function(a){b(a)},b:e,url:[z,"v2","history","sub-key",g,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,e=a.stop,f=a.start,n=a.end,j=a.reverse,a=a.limit,h=v(),i={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);e&&(i.stop="all");j&&(i.reverse="true");f&&(i.start=
f);n&&(i.end=n);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",r,g,d,c],data:i})},time:function(a){var b=v();t({a:b,timeout:5*N,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,e=a.channel,f=v();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[z,"publish",r,g,0,Z(e),f,Z(d)];s.push({a:f,timeout:5*N,url:e,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,c){function s(a){a?X(I,N):(z=Q(y,1),S=Q(y,1),X(function(){e.time(s)},N));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function I(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:O,a:a,b:function(){e.time(s)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(I,ka);d(function(a){a.e||(a.e=1,a.h(a.name))});(E=!E&&L&&A.get(g)||a[1])&&A.set(g,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(d){var c=b();if(j[c[1]].f)c[0](d,a,c[1])});X(I,ka)}}))}var p=a.channel,c=(c=c||a.callback)||a.message,r=a.connect||q(),
u=a.reconnect||q(),w=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,O=a.timeout||n,ka=a.windowing||f;a.restore&&(L=1);E=0;if(!p)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((p.join?p.join(","):""+p).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=c,h:r,i:w,j:u};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in b?b.uuids:[],function(d){h({action:"join",
uuid:d,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(I,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,e=v(),f=l;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);t({a:e,data:f,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",Z(c)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,
map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){O()||e._reset_offline();X(e.poll_online,N)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,N);X(e.poll_online2,u);return e}
function Za(a){function b(a){f||(f=1,clearTimeout(u),d&&(d.onerror=d.onload=l,d.abort&&d.abort(),d=l),a&&r())}function c(){if(!n){n=1;clearTimeout(u);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,n=0,u=X(function(){b(1)},$a),r=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=$a;url=a.url.join(ab);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(bb)}d.open("GET",url,k);d.send()}catch(y){return b(0),Za(a)}return b}function cb(a,b,c){W(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=k,a.returnValue=m,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,m):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function db(a){a.db=eb;a.xdr=Za;var b=la(a);b.init=db;if(a.notest)return b;cb("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});cb("offline",window,b._reset_offline);cb("offline",document,b._reset_offline);b.ready();return b}var ab="/",bb="&",$a=31E4,eb,fb="undefined"!=typeof localStorage&&localStorage;
eb={get:function(a){try{return fb?fb.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(fb)return fb.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=db)||"undefined"!==typeof exports&&(exports.k=db)||(PUBNUB=db);C=1;D=m;F=[];G="-pnpres";H=10;J=310;M=60;N=1E3;aa=/{([\w\-]+)}/g;
function ba(){return"x"+ ++C+""+ +new Date}function P(){return+new Date}var gb=Math.floor(20*Math.random());Q=function(a,b){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(b?R().split("-")[0]:20>++gb?gb:gb=1))||a};function da(a,b){function c(){f+b>P()?(clearTimeout(d),d=setTimeout(c,b)):(f=P(),a())}var d,f=0;return c}function ea(a,b){var c=[];W(a||[],function(a){b(a)&&c.push(a)});return c}function fa(a,b){return a.replace(aa,function(a,d){return b[d]||a})}
function X(a,b){return setTimeout(a,b)}function R(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});a&&a(b);return b}function W(a,b){if(a&&b)if("undefined"!=typeof a[0])for(var c=0,d=a.length;c<d;)b.call(a[c],a[c],c++);else for(c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}function Y(a,b){var c=[];W(a||[],function(a,f){c.push(b(a,f))});return c}
function Z(a){return Y(encodeURIComponent(a).split(""),function(a){return 0>"-_.!~*'()".indexOf(a)?a:"%"+a.charCodeAt(0).toString(16).toUpperCase()}).join("")}function $(a){var b=[];W(a,function(a,d){d.f&&b.push(a)});return b.sort()}function ga(){X(function(){D||(D=1,W(F,function(a){a()}))},N)}
function la(a){function b(){}function c(a){a&&(s.g=0);!s.g&&s.length&&(s.g=1,t(s.shift()))}function d(a){W($(j),function(b){(b=j[b])&&a(b)})}var f=+a.windowing||H,n=(+a.timeout||J)*N,u=(+a.keepalive||M)*N,r=a.publish_key||"",g=a.subscribe_key||"",w=a.ssl?"s":"",y="http"+w+"://"+(a.origin||"pubsub.pubnub.com"),z=Q(y),S=Q(y),s=[],T=0,U=0,K=0,L=0,V=0,E=0,j={},t=a.xdr,O=a._is_online||x(1),v=a.jsonp_cb||x(0),A=a.db||{get:q(),set:q()},B=a.uuid||A&&A.get(g+"uuid")||"",e={_reset_offline:function(){K&&K(1)},
LEAVE:function(a,b){var d={uuid:B},c=Q(y),e=v();0<a.indexOf(G)||("0"!=e&&(d.callback=e),t({l:b||w,timeout:2E3,a:e,data:d,url:[c,"v2","presence","sub_key",g,"channel",Z(a),"leave"]}))},history:function(a,b){var b=a.callback||b,d=a.count||a.limit||100,c=a.reverse||"false",e=a.error||q(),f=a.channel,j=a.start,n=a.end,h={},i=v();if(!f)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");h.stringtoken="true";h.count=d;h.reverse=c;i&&(h.callback=
i);j&&(h.start=j);n&&(h.end=n);t({a:i,data:h,c:function(a){b(a)},b:e,url:[z,"v2","history","sub-key",g,"channel",Z(f)]})},replay:function(a){var b=b||a.callback||q(),d=a.source,c=a.destination,e=a.stop,f=a.start,j=a.end,n=a.reverse,a=a.limit,h=v(),i={};if(!d)return error("Missing Source Channel");if(!c)return error("Missing Destination Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");"0"!=h&&(i.callback=h);e&&(i.stop="all");n&&(i.reverse="true");f&&(i.start=
f);j&&(i.end=j);a&&(i.count=a);t({a:h,c:function(a){b(a)},b:function(){b([0,"Disconnected"])},url:[z,"v1","replay",r,g,d,c],data:i})},time:function(a){var b=v();t({a:b,timeout:5*N,url:[z,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||q(),d=a.message,e=a.channel,f=v();if(!d)return error("Missing Message");if(!e)return error("Missing Channel");if(!r)return error("Missing Publish Key");if(!g)return error("Missing Subscribe Key");d=JSON.stringify(d);
e=[z,"publish",r,g,0,Z(e),f,Z(d)];s.push({a:f,timeout:5*N,url:e,data:{uuid:B},c:function(a){b(a);c(1)},b:function(){b([0,"Failed",d]);c(1)}});c()},unsubscribe:function(a){a=a.channel;E=0;L=1;a=Y((a.join?a.join(","):""+a).split(","),function(a){return a+","+a+G}).join(",");W(a.split(","),function(a){D&&e.LEAVE(a,0);j[a]=0});D&&b()},subscribe:function(a,c){function s(a){a?X(r,N):(z=Q(y,1),S=Q(y,1),X(function(){e.time(s)},N));d(function(b){if(a&&b.d)return b.d=0,b.j(b.name);!a&&!b.d&&(b.d=1,b.i(b.name))})}
function r(){var a=v(),b=$(j).join(",");b&&(K=t({timeout:ka,a:a,b:function(){e.time(s)},data:{uuid:B},url:[S,"subscribe",g,Z(b),a,E],c:function(a){if(!a)return X(r,La);d(function(a){a.e||(a.e=1,a.h(a.name))});E=!E&&L&&A.get(g)||a[1];Ka&&(Timetoken=1E4,Ka=0);A.set(g,a[1]);var b,c=(2<a.length?a[2]:"").split(",");b=function(){var a=c.shift()||"";return[(j[a]||{}).a||T,(a||U).split(G)[0]]};W(a[0],function(d){var c=b();if(j[c[1]].f)c[0](d,a,c[1])});X(r,La)}}))}var p=a.channel,c=(c=c||a.callback)||a.message,
u=a.connect||q(),w=a.reconnect||q(),O=a.disconnect||q(),h=a.presence||0,i=a.noheresync||0,Ka=a.backfill||0,ka=a.timeout||n,La=a.windowing||f;a.restore&&(L=1);E=0;if(!p)return error("Missing Channel");if(!c)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");W((p.join?p.join(","):""+p).split(","),function(a){var b=j[a]||{};j[U=a]={name:a,e:b.e,d:b.d,f:1,a:T=c,h:u,i:O,j:w};h&&(e.subscribe({channel:a+G,callback:h}),!b.f&&!i&&e.here_now({channel:a,callback:function(b){W("uuids"in
b?b.uuids:[],function(d){h({action:"join",uuid:d,timestamp:P(),occupancy:b.occupancy||1},b,a)})}}))});b=function(){e._reset_offline();clearTimeout(V);V=X(r,100)};if(!D)return F.push(b);b()},here_now:function(a,b){var b=a.callback||b,d=a.error||q(),c=a.channel,e=v(),f=l;if(!c)return error("Missing Channel");if(!b)return error("Missing Callback");if(!g)return error("Missing Subscribe Key");"0"!=e&&(f={},f.callback=e);t({a:e,data:f,c:function(a){b(a)},b:d,url:[z,"v2","presence","sub_key",g,"channel",
Z(c)]})},xdr:t,ready:ga,db:A,uuid:R,each:W,map:Y,grep:ea,supplant:fa,now:P,unique:ba,updater:da,poll_online:function(){O()||e._reset_offline();X(e.poll_online,N)},poll_online2:function(){e.time(function(a){a||e._reset_offline();X(e.poll_online2,u)})}};B||(B=e.uuid());A.set(g+"uuid",B);X(e.poll_online,N);X(e.poll_online2,u);return e}
function hb(a){function b(a){f||(f=1,clearTimeout(u),d&&(d.onerror=d.onload=l,d.abort&&d.abort(),d=l),a&&r())}function c(){if(!n){n=1;clearTimeout(u);try{response=JSON.parse(d.responseText)}catch(a){return b(1)}g(response)}}var d,f=0,n=0,u=X(function(){b(1)},ib),r=a.b||q(),g=a.c||q();try{d="undefined"!==typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest;d.onerror=d.onabort=function(){b(1)};d.onload=d.onloadend=c;d.timeout=ib;url=a.url.join(jb);if(a.data){var w=[];url+="?";for(key in a.data)w.push(key+
"="+a.data[key]);url+=w.join(kb)}d.open("GET",url,k);d.send()}catch(y){return b(0),hb(a)}return b}function lb(a,b,c){W(a.split(","),function(a){function f(a){a||(a=window.event);c(a)||(a.cancelBubble=k,a.returnValue=m,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}b.addEventListener?b.addEventListener(a,f,m):b.attachEvent?b.attachEvent("on"+a,f):b["on"+a]=f})}
function mb(a){a.db=nb;a.xdr=hb;var b=la(a);b.init=mb;if(a.notest)return b;lb("beforeunload",window,function(){each_channel(function(a){b.LEAVE(a.name,1)});return k});lb("offline",window,b._reset_offline);lb("offline",document,b._reset_offline);b.ready();return b}var jb="/",kb="&",ib=31E4,nb,ob="undefined"!=typeof localStorage&&localStorage;
nb={get:function(a){try{return ob?ob.getItem(a):-1==document.cookie.indexOf(a)?l:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||l}catch(b){}},set:function(a,b){try{if(ob)return ob.setItem(a,b)&&0;document.cookie=a+"="+b+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(c){}}};"undefined"!==typeof module&&(module.m=mb)||"undefined"!==typeof exports&&(exports.k=mb)||(PUBNUB=mb);
})();
